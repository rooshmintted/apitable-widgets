!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("react"),require("@apitable/widget-sdk"));else if("function"==typeof define&&define.amd)define(["react","@apitable/widget-sdk"],t);else{var n="object"==typeof exports?t(require("react"),require("@apitable/widget-sdk")):t(e._React,e["_@apitable/widget-sdk"]);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(e,t)=>(()=>{"use strict";var n={103:e=>{e.exports=t},857:t=>{t.exports=e}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={exports:{}};return n[e](a,a.exports,o),a.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};o.r(a),o.d(a,{default:()=>m});var i=o(857),l=o.n(i),c=o(103),s=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},d=function(e,t){return new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:2}).format(e)},p=function(e){var t=e.currency,n=e.setCurrency,r=e.showTransactions,o=e.setShowTransactions,a=e.groupBy,i=e.setGroupBy;return l().createElement("div",{style:{padding:"20px",backgroundColor:"#ffffff",borderRadius:"12px",marginBottom:"20px",border:"1px solid #e9ecef",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}},l().createElement("h3",{style:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600",color:"#2c3e50",display:"flex",alignItems:"center",gap:"8px"}},"‚öôÔ∏è Dashboard Settings"),l().createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px"}},l().createElement("div",null,l().createElement("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#495057"}},"Currency:"),l().createElement("select",{value:t,onChange:function(e){return n(e.target.value)},style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid #dee2e6",width:"100%",fontSize:"14px",backgroundColor:"white"}},l().createElement("option",{value:"USD"},"USD ($)"),l().createElement("option",{value:"EUR"},"EUR (‚Ç¨)"),l().createElement("option",{value:"GBP"},"GBP (¬£)"),l().createElement("option",{value:"JPY"},"JPY (¬•)"))),l().createElement("div",null,l().createElement("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#495057"}},"Group chart by:"),l().createElement("select",{value:a,onChange:function(e){return i(e.target.value)},style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid #dee2e6",width:"100%",fontSize:"14px",backgroundColor:"white"}},l().createElement("option",{value:"type"},"Type (Revenue/Expense)"),l().createElement("option",{value:"merchant"},"Merchant"),l().createElement("option",{value:"category"},"Category"),l().createElement("option",{value:"date"},"Date (Monthly)")))),l().createElement("div",{style:{marginTop:"16px"}},l().createElement("label",{style:{display:"flex",alignItems:"center",fontSize:"14px",cursor:"pointer",color:"#495057"}},l().createElement("input",{type:"checkbox",checked:r,onChange:function(e){return o(e.target.checked)},style:{marginRight:"10px",transform:"scale(1.1)"}}),"Show detailed transaction list")))},u=function(e){var t=e.data,n=e.currency,r=e.groupBy,o=Math.max.apply(Math,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}(t.map(function(e){return Math.max(e.revenue,e.expenses)})));return l().createElement("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",marginBottom:"20px",border:"1px solid #e9ecef",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}},l().createElement("h3",{style:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600",color:"#2c3e50",display:"flex",alignItems:"center",gap:"8px"}},"üìä ",function(){switch(r){case"merchant":return"Revenue vs Expenses by Merchant";case"category":return"Revenue vs Expenses by Category";case"date":return"Revenue vs Expenses by Month";default:return"Revenue vs Expenses Overview"}}()),0===t.length?l().createElement("div",{style:{textAlign:"center",padding:"40px",color:"#6c757d"}},l().createElement("div",{style:{fontSize:"48px",marginBottom:"16px"}},"üìà"),l().createElement("p",null,"No data available for the selected grouping")):l().createElement("div",{style:{overflowX:"auto"}},l().createElement("div",{style:{display:"flex",alignItems:"flex-end",gap:"20px",height:"200px",minWidth:120*t.length+"px",padding:"0 10px"}},t.map(function(e,t){return l().createElement("div",{key:t,style:{flex:"0 0 auto",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px"}},l().createElement("div",{style:{fontSize:"12px",marginBottom:"8px",fontWeight:"600",textAlign:"center",color:"#495057",wordBreak:"break-word",maxWidth:"100px"}},e.label),l().createElement("div",{style:{display:"flex",alignItems:"flex-end",gap:"4px",marginBottom:"8px"}},l().createElement("div",{style:{width:"30px",height:Math.max(e.revenue/o*140,8)+"px",backgroundColor:"#28a745",borderRadius:"4px 4px 0 0",position:"relative",display:"flex",alignItems:"flex-end",justifyContent:"center"}},e.revenue>0&&l().createElement("div",{style:{position:"absolute",top:"-20px",fontSize:"10px",fontWeight:"bold",color:"#28a745"}},"üìà")),l().createElement("div",{style:{width:"30px",height:Math.max(e.expenses/o*140,8)+"px",backgroundColor:"#dc3545",borderRadius:"4px 4px 0 0",position:"relative",display:"flex",alignItems:"flex-end",justifyContent:"center"}},e.expenses>0&&l().createElement("div",{style:{position:"absolute",top:"-20px",fontSize:"10px",fontWeight:"bold",color:"#dc3545"}},"üìâ"))),l().createElement("div",{style:{fontSize:"10px",textAlign:"center",color:"#6c757d",lineHeight:"1.2"}},l().createElement("div",{style:{color:"#28a745",fontWeight:"bold"}},d(e.revenue,n)),l().createElement("div",{style:{color:"#dc3545",fontWeight:"bold"}},d(e.expenses,n)),l().createElement("div",{style:{color:e.net>=0?"#28a745":"#dc3545",fontWeight:"bold",marginTop:"2px"}},"Net: ",d(e.net,n))))}))))},f=function(){var e=(0,c.useActiveViewId)(),t=(0,c.useFields)(e),n=(0,c.useRecords)(e),r=s((0,c.useSettingsButton)(),2),o=r[0],a=(r[1],s((0,c.useCloudStorage)("currency","USD"),2)),f=a[0],m=a[1],x=s((0,c.useCloudStorage)("showTransactions",!0),2),g=x[0],y=x[1],h=s((0,c.useCloudStorage)("groupBy","type"),2),v=h[0],b=h[1],E=t.find(function(e){return e.name.toLowerCase().includes("title")||e.type===c.FieldType.SingleText||e.type===c.FieldType.Text}),S=t.find(function(e){return e.name.toLowerCase().includes("type")||e.type===c.FieldType.SingleSelect&&e.name.toLowerCase().includes("type")}),w=t.find(function(e){return e.name.toLowerCase().includes("amount")||e.type===c.FieldType.Number||e.type===c.FieldType.Currency}),C=t.find(function(e){return e.name.toLowerCase().includes("category")}),T=t.find(function(e){return e.name.toLowerCase().includes("merchant")}),z=t.find(function(e){return e.name.toLowerCase().includes("date")||e.type===c.FieldType.DateTime||e.type===c.FieldType.CreatedTime}),R=(0,i.useMemo)(function(){if(!(E&&S&&w&&n.length))return{totalRevenue:0,totalExpenses:0,netProfit:0,profitMargin:0,transactions:[],revenueTransactions:[],expenseTransactions:[]};var e=n.map(function(e){var t=e.getCellValueString(E.id)||"Untitled",n=e.getCellValue(S.id)||"",r=Number(e.getCellValue(w.id))||0,o=C&&e.getCellValueString(C.id)||"Other",a=T&&e.getCellValueString(T.id)||"Unknown",i=z&&e.getCellValueString(z.id)||"",l="Expense",c=String(n).toLowerCase();return(c.includes("revenue")||"revenue"===c)&&(l="Revenue"),{id:e.id,title:t,type:l,amount:Math.abs(r),category:o,merchant:a,date:i}}),t=e.filter(function(e){return"Revenue"===e.type}),r=e.filter(function(e){return"Expense"===e.type}),o=t.reduce(function(e,t){return e+t.amount},0),a=r.reduce(function(e,t){return e+t.amount},0),i=o-a;return{totalRevenue:o,totalExpenses:a,netProfit:i,profitMargin:o>0?i/o*100:0,transactions:e,revenueTransactions:t,expenseTransactions:r}},[n,E,S,w,C,T,z]),k=(0,i.useMemo)(function(){var e=R.transactions;if(0===e.length)return[];var t={};return e.forEach(function(e){var n;switch(v){case"merchant":n=e.merchant;break;case"category":n=e.category;break;case"date":var r=new Date(e.date);n=isNaN(r.getTime())?"Unknown Date":r.toLocaleDateString("en-US",{year:"numeric",month:"short"});break;default:n=e.type}t[n]||(t[n]=[]),t[n].push(e)}),Object.entries(t).map(function(e){var t=s(e,2),n=t[0],r=t[1],o=r.filter(function(e){return"Revenue"===e.type}).reduce(function(e,t){return e+t.amount},0),a=r.filter(function(e){return"Expense"===e.type}).reduce(function(e,t){return e+t.amount},0);return{label:n,revenue:o,expenses:a,net:o-a,count:r.length}}).sort(function(e,t){return t.net-e.net})},[R,v]);if(!E||!S||!w)return l().createElement("div",{style:{padding:"40px",textAlign:"center",backgroundColor:"#f8f9fa",borderRadius:"12px",margin:"20px"}},l().createElement("div",{style:{fontSize:"64px",marginBottom:"20px"}},"‚ö†Ô∏è"),l().createElement("h2",{style:{color:"#dc3545",marginBottom:"20px",fontSize:"24px",fontWeight:"600"}},"Setup Required"),l().createElement("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"500px",margin:"0 auto",textAlign:"left"}},l().createElement("p",{style:{marginBottom:"16px",fontSize:"16px",color:"#495057"}},"This widget requires a datasheet with these fields:"),l().createElement("ul",{style:{color:"#6c757d",fontSize:"14px",lineHeight:"1.6",paddingLeft:"20px"}},l().createElement("li",null,l().createElement("strong",null,"Title:")," Text field for transaction descriptions"),l().createElement("li",null,l().createElement("strong",null,"Type:"),' Single select field with "Revenue" and "Expense" options'),l().createElement("li",null,l().createElement("strong",null,"Amount:")," Number or currency field for transaction amounts"),l().createElement("li",null,l().createElement("strong",null,"Category:")," Text field for categorization (optional)"),l().createElement("li",null,l().createElement("strong",null,"Merchant:")," Text field for merchant names (optional)"),l().createElement("li",null,l().createElement("strong",null,"Date:")," Date field for transaction dates (optional)")),l().createElement("p",{style:{marginTop:"20px",fontSize:"14px",color:"#6c757d",fontStyle:"italic"}},"Please ensure your datasheet has at least the required fields (Title, Type, Amount) and try again.")));var B=R.totalRevenue,W=R.totalExpenses,M=R.netProfit,A=R.profitMargin,D=R.revenueTransactions,I=R.expenseTransactions;return l().createElement("div",{style:{padding:"20px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',backgroundColor:"#f8f9fa",minHeight:"500px"}},o&&l().createElement(p,{currency:f,setCurrency:m,showTransactions:g,setShowTransactions:y,groupBy:v,setGroupBy:b}),l().createElement("div",{style:{textAlign:"center",marginBottom:"30px"}},l().createElement("h1",{style:{margin:"0 0 8px 0",fontSize:"28px",fontWeight:"700",color:"#2c3e50",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"}},"üí∞ Financial Dashboard"),l().createElement("p",{style:{margin:0,color:"#6c757d",fontSize:"16px",fontWeight:"500"}},"Profit & Loss Analysis ‚Ä¢ ",R.transactions.length," transactions")),l().createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"20px",marginBottom:"30px"}},l().createElement("div",{style:{backgroundColor:"#ffffff",border:"1px solid #e9ecef",borderLeft:"4px solid #28a745",borderRadius:"12px",padding:"24px",textAlign:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",transition:"transform 0.2s ease"}},l().createElement("div",{style:{fontSize:"16px",color:"#28a745",fontWeight:"600",marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},"üìà Total Revenue"),l().createElement("div",{style:{fontSize:"32px",fontWeight:"700",color:"#28a745",marginBottom:"4px"}},d(B,f)),l().createElement("div",{style:{fontSize:"14px",color:"#6c757d"}},D.length," transactions")),l().createElement("div",{style:{backgroundColor:"#ffffff",border:"1px solid #e9ecef",borderLeft:"4px solid #dc3545",borderRadius:"12px",padding:"24px",textAlign:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",transition:"transform 0.2s ease"}},l().createElement("div",{style:{fontSize:"16px",color:"#dc3545",fontWeight:"600",marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},"üìâ Total Expenses"),l().createElement("div",{style:{fontSize:"32px",fontWeight:"700",color:"#dc3545",marginBottom:"4px"}},d(W,f)),l().createElement("div",{style:{fontSize:"14px",color:"#6c757d"}},I.length," transactions")),l().createElement("div",{style:{backgroundColor:"#ffffff",border:"1px solid #e9ecef",borderLeft:"4px solid "+(M>=0?"#17a2b8":"#dc3545"),borderRadius:"12px",padding:"24px",textAlign:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",transition:"transform 0.2s ease"}},l().createElement("div",{style:{fontSize:"16px",color:M>=0?"#17a2b8":"#dc3545",fontWeight:"600",marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},M>=0?"‚úÖ":"‚ùå"," Net Profit"),l().createElement("div",{style:{fontSize:"32px",fontWeight:"700",color:M>=0?"#17a2b8":"#dc3545",marginBottom:"4px"}},d(M,f)),l().createElement("div",{style:{fontSize:"14px",color:"#6c757d"}},A.toFixed(1),"% margin"))),l().createElement(u,{data:k,currency:f,groupBy:v}),g&&R.transactions.length>0&&l().createElement("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",border:"1px solid #e9ecef",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}},l().createElement("h3",{style:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600",color:"#2c3e50",display:"flex",alignItems:"center",gap:"8px"}},"üìã Transaction Details"),l().createElement("div",{style:{maxHeight:"400px",overflowY:"auto"}},R.transactions.map(function(e,t){return l().createElement("div",{key:e.id,style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr",gap:"16px",alignItems:"center",padding:"12px 0",borderBottom:t<R.transactions.length-1?"1px solid #f8f9fa":"none",fontSize:"14px"}},l().createElement("div",null,l().createElement("div",{style:{fontWeight:"600",marginBottom:"2px"}},e.title),l().createElement("div",{style:{fontSize:"12px",color:"Revenue"===e.type?"#28a745":"#dc3545",fontWeight:"500"}},"Revenue"===e.type?"üìà":"üìâ"," ",e.type)),l().createElement("div",{style:{fontWeight:"500",color:"#6c757d"}},e.category),l().createElement("div",{style:{fontWeight:"500",color:"#6c757d"}},e.merchant),l().createElement("div",{style:{fontWeight:"500",color:"#6c757d",fontSize:"12px"}},e.date?new Date(e.date).toLocaleDateString():"No date"),l().createElement("div",{style:{fontWeight:"700",color:"Revenue"===e.type?"#28a745":"#dc3545",textAlign:"right"}},d(e.amount,f)))}))),0===R.transactions.length&&l().createElement("div",{style:{textAlign:"center",padding:"60px 40px",color:"#6c757d",backgroundColor:"white",borderRadius:"12px",border:"1px solid #e9ecef",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}},l().createElement("div",{style:{fontSize:"64px",marginBottom:"20px"}},"üìä"),l().createElement("h3",{style:{margin:"0 0 12px 0",color:"#495057",fontSize:"20px",fontWeight:"600"}},"No financial data found"),l().createElement("p",{style:{margin:"0 auto",fontSize:"16px",maxWidth:"400px"}},"Add some records with revenue and expense transactions to see your financial dashboard come to life.")))};(0,c.initializeWidget)(f,"wpk123456A89B");const m=f;return a})());