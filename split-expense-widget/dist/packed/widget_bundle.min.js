!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("react"),require("@apitable/widget-sdk"));else if("function"==typeof define&&define.amd)define(["react","@apitable/widget-sdk"],t);else{var n="object"==typeof exports?t(require("react"),require("@apitable/widget-sdk")):t(e._React,e["_@apitable/widget-sdk"]);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(e,t)=>(()=>{"use strict";var n={103:e=>{e.exports=t},857:t=>{t.exports=e}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={exports:{}};return n[e](i,i.exports,o),i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};o.r(i),o.d(i,{default:()=>p});var a=o(857),l=o(103),c=function(){return c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},c.apply(this,arguments)},d=function(e,t){return void 0===t&&(t="USD"),new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:2}).format(e)},u=function(e){var t=e.splitTx,n=e.currency,r=e.onAmountChange,o=(0,a.useState)(t.editedAmount||t.amount),i=o[0],l=o[1];return a.createElement("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 120px",gap:"12px",alignItems:"center",padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"8px",marginBottom:"8px",fontSize:"14px"}},a.createElement("div",null,a.createElement("div",{style:{fontWeight:"600",marginBottom:"2px"}},t.title),a.createElement("div",{style:{fontSize:"12px",color:"#6c757d",fontWeight:"500"}},"Product: ",t.product)),a.createElement("div",{style:{color:"Revenue"===t.type?"#28a745":"#dc3545",fontWeight:"500"}},t.type),a.createElement("div",{style:{fontWeight:"500",color:"#6c757d"}},t.category),a.createElement("div",{style:{fontWeight:"500",color:"#6c757d"}},t.merchant),a.createElement("div",{style:{fontWeight:"500",color:"#6c757d",fontSize:"12px"}},t.date?new Date(t.date).toLocaleDateString():"No date"),a.createElement("div",{style:{fontWeight:"500",color:"#6c757d"}},"Original: ",d(t.amount,n)),a.createElement("input",{type:"number",value:i,onChange:function(e){return n=e.target.value,o=parseFloat(n)||0,l(o),void r(t.originalId,t.product,o);var n,o},step:"0.01",min:"0",style:{padding:"6px 8px",borderRadius:"4px",border:"1px solid #dee2e6",fontSize:"14px",textAlign:"right",fontWeight:"600",color:"#000000"}}))},s=function(){var e=(0,l.useActiveViewId)(),t=(0,l.useFields)(e),n=(0,l.useRecords)(e),r=(0,l.useDatasheet)(),o=(0,l.useSettingsButton)(),i=(o[0],o[1],"USD"),s=(0,a.useState)(null),p=s[0],f=s[1],m=(0,a.useState)([]),g=m[0],y=m[1],x=(0,a.useState)(!1),h=x[0],v=x[1],b=t.find(function(e){return e.name.toLowerCase().includes("title")||e.type===l.FieldType.SingleText||e.type===l.FieldType.Text}),E=t.find(function(e){return e.name.toLowerCase().includes("type")||e.type===l.FieldType.SingleSelect&&e.name.toLowerCase().includes("type")}),S=t.find(function(e){return e.name.toLowerCase().includes("amount")||e.type===l.FieldType.Number||e.type===l.FieldType.Currency}),C=t.find(function(e){return e.name.toLowerCase().includes("category")}),w=t.find(function(e){return e.name.toLowerCase().includes("merchant")}),T=t.find(function(e){return e.name.toLowerCase().includes("date")||e.type===l.FieldType.DateTime||e.type===l.FieldType.CreatedTime}),k=t.find(function(e){return e.name.toLowerCase().includes("products")||e.name.toLowerCase().includes("product")}),A=t.find(function(e){return e.name.toLowerCase().includes("reconciled")||e.type===l.FieldType.Checkbox}),R=(0,a.useState)(new Set),W=R[0],z=R[1],I=(0,a.useMemo)(function(){return b&&E&&S&&k&&n.length?n.map(function(e){var t=e.getCellValueString(b.id)||"Untitled",n=e.getCellValue(E.id)||"",r=Number(e.getCellValue(S.id))||0,o=C&&e.getCellValueString(C.id)||"Other",i=w&&e.getCellValueString(w.id)||"Unknown",a=T&&e.getCellValueString(T.id)||"",l=e.getCellValue(k.id)||"",c=!!A&&Boolean(e.getCellValue(A.id)),d=[];if("string"==typeof l)d=l.split(",").map(function(e){return{name:e.trim()}}).filter(function(e){return e.name.length>0});else if(Array.isArray(l)){d=l.map(function(e){if("object"==typeof e&&null!==e){var t=e.title||e.name||e.text||e.value||String(e);return{id:e.id||e.recordId||e.key||e._id,name:String(t)}}return{name:String(e).trim()}}).filter(function(e){return e.name.length>0});var u=[],s=new Set;d.forEach(function(e){var t=e.id?"id:"+e.id:"name:"+e.name;s.has(t)||(s.add(t),u.push(e))}),d=u}var p="Expense",f=String(n).toLowerCase();return(f.includes("revenue")||"revenue"===f)&&(p="Revenue"),{id:e.id,title:t,type:p,amount:Math.abs(r),category:o,merchant:i,date:a,products:d,reconciled:c,productCount:d.length}}).filter(function(e){return e.productCount>1&&!e.reconciled&&!W.has(e.id)}):[]},[n,b,E,S,C,w,T,k,A,W]),B=function(e,t,n){y(function(r){return r.map(function(r){return r.originalId===e&&r.product===t?c(c({},r),{editedAmount:n}):r})})};return b&&E&&S&&k?a.createElement("div",{style:{padding:"20px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',backgroundColor:"#f8f9fa",minHeight:"500px"}},a.createElement("div",{style:{textAlign:"center",marginBottom:"30px"}},a.createElement("h1",{style:{margin:"0 0 8px 0",fontSize:"28px",fontWeight:"700",color:"#2c3e50",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"}},"âœ‚ï¸ Split Expense Widget"),a.createElement("p",{style:{margin:0,color:"#6c757d",fontSize:"16px",fontWeight:"500"}},"Split transactions with multiple products â€¢ ",I.length," transactions to split")),!p&&a.createElement("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",marginBottom:"20px",border:"1px solid #e9ecef",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}},a.createElement("h3",{style:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600",color:"#2c3e50",display:"flex",alignItems:"center",gap:"8px"}},"ðŸ“‹ Transactions to Split"),0===I.length?a.createElement("div",{style:{textAlign:"center",padding:"40px",color:"#6c757d"}},a.createElement("div",{style:{fontSize:"48px",marginBottom:"16px"}},"âœ…"),a.createElement("h4",{style:{margin:"0 0 12px 0",color:"#495057"}},"No transactions to split"),a.createElement("p",{style:{margin:0}},"All transactions with multiple products have been reconciled or no multi-product transactions found.")):a.createElement("div",{style:{maxHeight:"400px",overflowY:"auto"}},I.map(function(e){return a.createElement("div",{key:e.id,style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 100px",gap:"16px",alignItems:"center",padding:"12px",borderBottom:"1px solid #f8f9fa",fontSize:"14px",cursor:"pointer",borderRadius:"6px",transition:"background-color 0.2s"},onMouseEnter:function(e){return e.currentTarget.style.backgroundColor="#f8f9fa"},onMouseLeave:function(e){return e.currentTarget.style.backgroundColor="transparent"},onClick:function(){return function(e){f(e);var t=e.amount/e.productCount,n=e.products.map(function(n){return{originalId:e.id,title:e.title,type:e.type,amount:t,category:e.category,merchant:e.merchant,date:e.date,product:n.name,productId:n.id,editedAmount:t}});y(n)}(e)}},a.createElement("div",null,a.createElement("div",{style:{fontWeight:"600",marginBottom:"2px"}},e.title),a.createElement("div",{style:{fontSize:"12px",color:"#6c757d",fontWeight:"500"}},e.productCount," products: ",e.products.map(function(e){return e.name}).join(", "))),a.createElement("div",{style:{color:"Revenue"===e.type?"#28a745":"#dc3545",fontWeight:"500"}},e.type),a.createElement("div",{style:{fontWeight:"500",color:"#6c757d"}},e.category),a.createElement("div",{style:{fontWeight:"500",color:"#6c757d"}},e.merchant),a.createElement("div",{style:{fontWeight:"500",color:"#6c757d",fontSize:"12px"}},e.date?new Date(e.date).toLocaleDateString():"No date"),a.createElement("div",{style:{fontWeight:"700",color:"Revenue"===e.type?"#28a745":"#dc3545",textAlign:"right"}},d(e.amount,i)),a.createElement("button",{style:{padding:"6px 12px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",fontWeight:"500",cursor:"pointer"}},"Split"))}))),p&&a.createElement("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",marginBottom:"20px",border:"1px solid #e9ecef",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}},a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"}},a.createElement("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#2c3e50",display:"flex",alignItems:"center",gap:"8px"}},"âœ‚ï¸ Splitting: ",p.title),a.createElement("button",{onClick:function(){f(null),y([])},style:{padding:"6px 12px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:"pointer"}},"Cancel")),a.createElement("div",{style:{backgroundColor:"#e7f3ff",padding:"12px",borderRadius:"6px",marginBottom:"20px",fontSize:"14px",color:"#004085"}},a.createElement("strong",null,"Original Amount:")," ",d(p.amount,i)," â€¢",a.createElement("strong",null," Products:")," ",p.productCount," â€¢",a.createElement("strong",null," Amount per product:")," ",d(p.amount/p.productCount,i)),a.createElement("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 120px",gap:"12px",alignItems:"center",padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"6px",marginBottom:"12px",fontSize:"12px",fontWeight:"600",color:"#6c757d"}},a.createElement("div",null,"TRANSACTION & PRODUCT"),a.createElement("div",null,"TYPE"),a.createElement("div",null,"CATEGORY"),a.createElement("div",null,"MERCHANT"),a.createElement("div",null,"DATE"),a.createElement("div",null,"ORIGINAL"),a.createElement("div",null,"NEW AMOUNT")),g.map(function(e,t){return a.createElement(u,{key:e.originalId+"-"+e.product+"-"+t,splitTx:e,currency:i,onAmountChange:B})}),a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"20px",padding:"16px",backgroundColor:"#f8f9fa",borderRadius:"6px"}},a.createElement("div",{style:{fontSize:"14px",color:"#6c757d"}},a.createElement("strong",null,"Total New Amount:")," ",d(g.reduce(function(e,t){return e+(t.editedAmount||t.amount)},0),i)),a.createElement("button",{onClick:function(){return e=void 0,t=void 0,o=function(){var e,t;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(n){switch(n.label){case 0:if(!p||!r||0===g.length)return console.error("Missing required data for reconciliation"),[2];if(h)return[2];v(!0),n.label=1;case 1:if(n.trys.push([1,3,4,5]),g.length!==p.productCount)throw new Error("Mismatch: Expected "+p.productCount+" splits but got "+g.length);return e=g.map(function(e){var t={};return b&&(t[b.id]=e.title),E&&(t[E.id]=e.type),S&&(t[S.id]=e.editedAmount||e.amount),C&&(t[C.id]=e.category),w&&(t[w.id]=e.merchant),T&&(t[T.id]=e.date),k&&e.productId&&(t[k.id]=[e.productId]),A&&(t[A.id]=!1),{valuesMap:t}}),[4,r.addRecords(e)];case 2:return n.sent(),z(function(e){return new Set(function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,l=i.length;a<l;a++,o++)r[o]=i[a];return r}(Array.from(e),[p.id]))}),f(null),y([]),alert("Successfully created "+e.length+" split transactions! Original transaction is now hidden. You can manually mark it as reconciled."),[3,5];case 3:return t=n.sent(),console.error("Error creating split transactions:",t),alert("Error creating split transactions: "+(t instanceof Error?t.message:String(t))+". Please try again."),[3,5];case 4:return v(!1),[7];case 5:return[2]}})},new((n=void 0)||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function l(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,l)}c((o=o.apply(e,t||[])).next())});var e,t,n,o},disabled:h,style:{padding:"12px 24px",backgroundColor:h?"#6c757d":"#28a745",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:h?"not-allowed":"pointer"}},h?"Processing...":"Split Transaction")))):a.createElement("div",{style:{padding:"40px",textAlign:"center",backgroundColor:"#f8f9fa",borderRadius:"12px",margin:"20px"}},a.createElement("div",{style:{fontSize:"64px",marginBottom:"20px"}},"âš ï¸"),a.createElement("h2",{style:{color:"#dc3545",marginBottom:"20px",fontSize:"24px",fontWeight:"600"}},"Setup Required"),a.createElement("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"500px",margin:"0 auto",textAlign:"left"}},a.createElement("p",{style:{marginBottom:"16px",fontSize:"16px",color:"#495057"}},"This widget requires a datasheet with these fields:"),a.createElement("ul",{style:{color:"#6c757d",fontSize:"14px",lineHeight:"1.6",paddingLeft:"20px"}},a.createElement("li",null,a.createElement("strong",null,"Title:")," Text field for transaction descriptions"),a.createElement("li",null,a.createElement("strong",null,"Type:"),' Single select field with "Revenue" and "Expense" options'),a.createElement("li",null,a.createElement("strong",null,"Amount:")," Number or currency field for transaction amounts"),a.createElement("li",null,a.createElement("strong",null,"Products:")," Text field for comma-separated product list"),a.createElement("li",null,a.createElement("strong",null,"Category:")," Text field for categorization (optional)"),a.createElement("li",null,a.createElement("strong",null,"Merchant:")," Text field for merchant names (optional)"),a.createElement("li",null,a.createElement("strong",null,"Date:")," Date field for transaction dates (optional)"),a.createElement("li",null,a.createElement("strong",null,"Reconciled:")," Checkbox field to track reconciliation status (optional)")),a.createElement("p",{style:{marginTop:"20px",fontSize:"14px",color:"#6c757d",fontStyle:"italic"}},"Please ensure your datasheet has the required fields and try again.")))};(0,l.initializeWidget)(s,"wpk789456B12G");const p=s;return i})());