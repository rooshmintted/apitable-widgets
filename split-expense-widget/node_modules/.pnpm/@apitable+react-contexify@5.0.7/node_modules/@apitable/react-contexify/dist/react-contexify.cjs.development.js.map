{"version":3,"file":"react-contexify.cjs.development.js","sources":["../src/components/RefTrackerProvider.tsx","../src/core/eventManager.ts","../src/hooks/usePrevious.ts","../src/hooks/useRefTracker.ts","../src/core/contextMenu.ts","../src/hooks/useContextMenu.ts","../src/components/menuController.ts","../src/constants.ts","../src/components/Item.tsx","../src/components/Submenu.tsx","../src/components/utils.ts","../src/components/Menu.tsx","../src/components/Separator.tsx"],"sourcesContent":["import React, { useContext, createContext } from 'react';\nimport { RefTracker } from '../hooks';\n\nconst Context = createContext({} as RefTracker);\n\n/**\n * Access parent ref tracker.\n */\nexport function useRefTrackerContext() {\n  return useContext(Context);\n}\n\nexport interface RefTrackerProviderProps {\n  refTracker: RefTracker;\n}\n\nexport const RefTrackerProvider: React.FC<RefTrackerProviderProps> = props => {\n  return (\n    <Context.Provider value={props.refTracker}>\n      {props.children}\n    </Context.Provider>\n  );\n};\n","import { EVENT } from '../constants';\n\nexport type EventType = string | number | symbol;\nexport type Handler<T = any> = (args: T) => void;\n\nexport interface EventManager<E = EventType> {\n  on<T = any>(event: E, handler: Handler<T>): EventManager<E>;\n  off<T = any>(event: E, handler?: Handler<T>): EventManager<E>;\n  emit<T = any>(event: E, args?: T): EventManager<E>;\n}\n\nfunction createEventManager<E = EventType>(): EventManager<E> {\n  const eventList = new Map<E, Set<Handler>>();\n\n  return {\n    on<T = any>(event: E, handler: Handler<T>) {\n      //eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      eventList.has(event)\n        ? eventList.get(event)?.add(handler)\n        : eventList.set(event, new Set([handler]));\n      return this;\n    },\n    off<T = any>(event: E, handler?: Handler<T>) {\n      handler ? eventList.get(event)!.delete(handler) : eventList.delete(event);\n      return this;\n    },\n    emit<T = any>(event: E, args: T) {\n      if (process.env.NODE !== 'production') {\n        const currentEv = (event as unknown) as number;\n\n        if (!eventList.has(event) && currentEv !== EVENT.HIDE_ALL) {\n          console.error(\n            `It seems that the menu you are trying to display is not renderer or you have a menu id mismatch.`,\n            `You used the menu id: ${event}`\n          );\n        }\n      }\n      eventList.has(event) &&\n        eventList.get(event)!.forEach((handler: Handler<T>) => {\n          handler(args);\n        });\n      return this;\n    },\n  };\n}\n\nexport const eventManager = createEventManager();\n","import { useEffect, useRef } from 'react';\n\nexport function usePrevious<T>(value: T) {\n  const ref = useRef<T>();\n\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n\n  return ref.current;\n}\n","import { useRef } from 'react';\n\nexport interface RefTrackerValue {\n  node: HTMLElement;\n  isSubmenu: boolean;\n  submenuRefTracker?: RefTracker;\n}\n\nexport type RefTracker = ReturnType<typeof useRefTracker>;\n\n/**\n * Used to store children refs\n */\nexport function useRefTracker() {\n  return useRef<Map<HTMLElement, RefTrackerValue>>(new Map()).current;\n}\n","import { eventManager } from './eventManager';\nimport { MenuId, TriggerEvent } from '../types';\nimport { SyntheticEvent } from 'react';\n\nimport { EVENT } from '../constants';\n\nexport interface ShowContextMenuParams {\n  id: MenuId;\n  event: TriggerEvent;\n  props?: any;\n  position?: {\n    x: number;\n    y: number;\n  } | null;\n}\n\nexport interface ContextMenu {\n  show: (params: ShowContextMenuParams) => void;\n  hideAll: () => void;\n}\n\nconst contextMenu: ContextMenu = {\n  show({ id, event, props, position }) {\n    if (event.preventDefault) event.preventDefault();\n\n    eventManager.emit(EVENT.HIDE_ALL).emit(id, {\n      event: (event as SyntheticEvent).nativeEvent || event,\n      props,\n      position,\n    });\n  },\n  hideAll() {\n    eventManager.emit(EVENT.HIDE_ALL);\n  },\n};\n\nexport { contextMenu };\n","import { contextMenu } from '../core';\nimport { ContextMenuParams, TriggerEvent } from '../types';\n\nexport type UseContextMenuProps = Partial<\n  Pick<ContextMenuParams, 'id' | 'props'>\n>;\n\nexport function useContextMenu(props?: UseContextMenuProps) {\n  return {\n    show(event: TriggerEvent, params?: Omit<ContextMenuParams, 'event'>) {\n      if (process.env.NODE_ENV === 'development') {\n        if (!props?.id && !params?.id)\n          console.error(\n            \"You need to provide an id when initializing the hook `useContextMenu({ id: 'your id' })` or when you display the menu `show(e, { id: 'your id' })`. The later is used to override the one defined during initialization.\"\n          );\n      }\n      contextMenu.show({\n        id: (params?.id || props?.id) as string,\n        props: params?.props || props?.props,\n        event: event,\n        position: params?.position,\n      });\n    },\n    hideAll() {\n      contextMenu.hideAll();\n    },\n  };\n}\n","import { RefTrackerValue } from '../hooks';\nimport { STYLE } from '../constants';\n\ninterface Menu<T = RefTrackerValue> {\n  items: T[];\n  isRoot: boolean;\n  focusedIndex: number;\n  parentNode: HTMLElement;\n}\n\n/**\n * Used to control keyboard navigation\n */\nexport function createMenuController() {\n  const menuList = new Map<HTMLElement, Menu>();\n  let focusedIndex: number;\n  let parentNode: HTMLElement;\n  let isAtRoot: boolean;\n  let currentItems: RefTrackerValue[];\n  let forceCloseSubmenu = false;\n\n  function init(rootMenu: RefTrackerValue[]) {\n    currentItems = rootMenu;\n    focusedIndex = -1;\n    isAtRoot = true;\n  }\n\n  function focusSelectedItem() {\n    currentItems[focusedIndex].node.focus();\n  }\n\n  function isSubmenuFocused() {\n    return focusedIndex >= 0 && currentItems[focusedIndex].isSubmenu;\n  }\n\n  function getSubmenuItems() {\n    return Array.from(currentItems[focusedIndex].submenuRefTracker!.values());\n  }\n\n  function isFocused() {\n    if (focusedIndex === -1) {\n      // focus first item\n      moveDown();\n      return false;\n    }\n\n    return true;\n  }\n\n  function moveDown() {\n    if (focusedIndex + 1 < currentItems.length) {\n      focusedIndex++;\n    } else if (focusedIndex + 1 === currentItems.length) {\n      focusedIndex = 0;\n    }\n\n    if (forceCloseSubmenu) closeSubmenu();\n\n    focusSelectedItem();\n  }\n\n  function moveUp() {\n    if (focusedIndex === -1 || focusedIndex === 0) {\n      focusedIndex = currentItems.length - 1;\n    } else if (focusedIndex - 1 < currentItems.length) {\n      focusedIndex--;\n    }\n\n    if (forceCloseSubmenu) closeSubmenu();\n\n    focusSelectedItem();\n  }\n\n  function openSubmenu() {\n    if (isFocused() && isSubmenuFocused()) {\n      const submenuItems = getSubmenuItems();\n      const currentNode = currentItems[focusedIndex].node;\n\n      menuList.set(currentNode, {\n        isRoot: isAtRoot,\n        focusedIndex,\n        parentNode: parentNode || currentNode,\n        items: currentItems,\n      });\n\n      currentNode.classList.add(STYLE.submenuOpen);\n      parentNode = currentNode;\n\n      if (submenuItems.length > 0) {\n        focusedIndex = 0;\n        currentItems = submenuItems;\n      } else {\n        forceCloseSubmenu = true;\n      }\n\n      isAtRoot = false;\n\n      focusSelectedItem();\n      return true;\n    }\n    return false;\n  }\n\n  function closeSubmenu() {\n    if (isFocused() && !isAtRoot) {\n      const {\n        isRoot,\n        items,\n        focusedIndex: parentFocusedIndex,\n        parentNode: menuParentNode,\n      } = menuList.get(parentNode)!;\n\n      parentNode.classList.remove(STYLE.submenuOpen);\n\n      currentItems = items;\n      parentNode = menuParentNode;\n\n      if (isRoot) {\n        isAtRoot = true;\n        menuList.clear();\n      }\n      if (!forceCloseSubmenu) {\n        focusedIndex = parentFocusedIndex;\n        focusSelectedItem();\n      }\n    }\n  }\n\n  return {\n    init,\n    moveDown,\n    moveUp,\n    openSubmenu,\n    closeSubmenu,\n  };\n}\n","/*\n * css classes mapping\n * */\nexport const enum STYLE {\n  menu = 'react-contexify',\n  submenu = 'react-contexify react-contexify__submenu',\n  submenuArrow = 'react-contexify__submenu-arrow',\n  submenuOpen = 'react-contexify__submenu--is-open',\n  separator = 'react-contexify__separator',\n  item = 'react-contexify__item',\n  itemDisabled = 'react-contexify__item--disabled',\n  itemContent = 'react-contexify__item__content',\n  theme = 'react-contexify__theme--',\n  animationWillEnter = 'react-contexify__will-enter--',\n  animationWillLeave = 'react-contexify__will-leave--',\n}\n\nexport const enum EVENT {\n  HIDE_ALL,\n}\n\nexport const theme = {\n  light: 'light',\n  dark: 'dark',\n};\n\nexport const animation = {\n  fade: 'fade',\n  flip: 'flip',\n  scale: 'scale',\n  slide: 'slide',\n};\n\nexport const NOOP = () => {};\n","import React, { ReactNode } from 'react';\nimport cx from 'clsx';\n\nimport {\n  ItemParams,\n  InternalProps,\n  BooleanPredicate,\n  HandlerParamsEvent,\n} from '../types';\nimport { useRefTrackerContext } from './RefTrackerProvider';\nimport { NOOP, STYLE } from '../constants';\nimport { getPredicateValue } from './utils';\n\nexport interface ItemProps\n  extends InternalProps,\n    Omit<React.HTMLAttributes<HTMLElement>, 'hidden' | 'disabled' | 'onClick'> {\n  /**\n   * Any valid node that can be rendered\n   */\n  children: ReactNode;\n\n  /**\n   * Passed to the `Item` onClick callback. Accessible via `data`\n   */\n  data?: any;\n\n  /**\n   * Disable `Item`. If a function is used, a boolean must be returned\n   *\n   * @param props The props passed when you called `show(e, {props: yourProps})`\n   * @param data The data defined on the `Item`\n   * @param triggerEvent The event that triggered the context menu\n   *\n   *\n   * ```\n   * function isItemDisabled({ triggerEvent, props, data }: PredicateParams<type of props, type of data>): boolean\n   * <Item disabled={isItemDisabled} data={data}>content</Item>\n   * ```\n   */\n  disabled?: BooleanPredicate;\n\n  /**\n   * Hide the `Item`. If a function is used, a boolean must be returned\n   *\n   * @param props The props passed when you called `show(e, {props: yourProps})`\n   * @param data The data defined on the `Item`\n   * @param triggerEvent The event that triggered the context menu\n   *\n   *\n   * ```\n   * function isItemHidden({ triggerEvent, props, data }: PredicateParams<type of props, type of data>): boolean\n   * <Item hidden={isItemHidden} data={data}>content</Item>\n   * ```\n   */\n  hidden?: BooleanPredicate;\n\n  /**\n   * Callback when the `Item` is clicked.\n   *\n   * @param event The event that occured on the Item node\n   * @param props The props passed when you called `show(e, {props: yourProps})`\n   * @param data The data defined on the `Item`\n   * @param triggerEvent The event that triggered the context menu\n   *\n   * ```\n   * function handleItemClick({ triggerEvent, event, props, data }: ItemParams<type of props, type of data>){\n   *    // retrieve the id of the Item or any other dom attribute\n   *    const id = e.currentTarget.id;\n   *\n   *    // access the props and the data\n   *    console.log(props, data);\n   *\n   *    // access the coordinate of the mouse when the menu has been displayed\n   *    const {  clientX, clientY } = triggerEvent;\n   *\n   * }\n   *\n   * <Item id=\"item-id\" onClick={handleItemClick} data={{key: 'value'}}>Something</Item>\n   * ```\n   */\n  onClick?: (args: ItemParams) => void;\n}\n\nexport const Item: React.FC<ItemProps> = ({\n  children,\n  className,\n  style,\n  triggerEvent,\n  data,\n  propsFromTrigger,\n  onClick = NOOP,\n  disabled = false,\n  hidden = false,\n  ...rest\n}) => {\n  const refTracker = useRefTrackerContext();\n  const handlerParams = {\n    data,\n    triggerEvent: triggerEvent as HandlerParamsEvent,\n    props: propsFromTrigger,\n  };\n  const isDisabled = getPredicateValue(disabled, handlerParams);\n  const isHidden = getPredicateValue(hidden, handlerParams);\n\n  function handleClick(e: React.MouseEvent<HTMLElement>) {\n    (handlerParams as ItemParams).event = e;\n    isDisabled ? e.stopPropagation() : onClick(handlerParams as ItemParams);\n  }\n\n  function trackRef(node: HTMLElement | null) {\n    if (node && !isDisabled)\n      refTracker.set(node, {\n        node,\n        isSubmenu: false,\n      });\n  }\n\n  function handleKeyDown(e: React.KeyboardEvent<HTMLElement>) {\n    if (e.key === 'Enter') {\n      (handlerParams as ItemParams).event = e;\n      onClick(handlerParams as ItemParams);\n    }\n  }\n\n  if (isHidden) return null;\n\n  const cssClasses = cx(STYLE.item, className, {\n    [`${STYLE.itemDisabled}`]: isDisabled,\n  });\n\n  return (\n    <div\n      {...rest}\n      className={cssClasses}\n      style={style}\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n      ref={trackRef}\n      tabIndex={-1}\n      role=\"menuitem\"\n      aria-disabled={isDisabled}\n    >\n      <div className={STYLE.itemContent}>{children}</div>\n    </div>\n  );\n};\n","import React, { ReactNode, useEffect, useRef, useState } from 'react';\nimport cx from 'clsx';\n\nimport { InternalProps, BooleanPredicate, HandlerParamsEvent } from '../types';\nimport { RefTrackerProvider, useRefTrackerContext } from './RefTrackerProvider';\nimport { useRefTracker } from '../hooks';\nimport { STYLE } from '../constants';\nimport { cloneItems, getPredicateValue } from './utils';\n\nexport interface SubMenuProps\n  extends InternalProps,\n    Omit<React.HTMLAttributes<HTMLElement>, 'hidden'> {\n  /**\n   * Any valid node that can be rendered\n   */\n  label: ReactNode;\n\n  /**\n   * Any valid node that can be rendered\n   */\n  children: ReactNode;\n\n  /**\n   * Render a custom arrow\n   */\n  arrow?: ReactNode;\n\n  /**\n   * Disable the `Submenu`. If a function is used, a boolean must be returned\n   */\n  disabled?: BooleanPredicate;\n\n  /**\n   * Hide the `Submenu` and his children. If a function is used, a boolean must be returned\n   */\n  hidden?: BooleanPredicate;\n}\n\ninterface SubMenuState {\n  left?: string | number;\n  right?: string | number;\n  top?: string | number;\n  bottom?: string | number;\n}\n\nexport const Submenu: React.FC<SubMenuProps> = ({\n  arrow = 'â–¶',\n  children,\n  disabled = false,\n  hidden = false,\n  label,\n  className,\n  triggerEvent,\n  propsFromTrigger,\n  style,\n  ...rest\n}) => {\n  const menuRefTracker = useRefTrackerContext();\n  const refTracker = useRefTracker();\n  const nodeRef = useRef<HTMLDivElement>(null);\n  const [position, setPosition] = useState<SubMenuState>({\n    left: '100%',\n    top: 0,\n    bottom: 'initial',\n  });\n  const handlerParams = {\n    triggerEvent: triggerEvent as HandlerParamsEvent,\n    props: propsFromTrigger,\n  };\n  const isDisabled = getPredicateValue(disabled, handlerParams);\n  const isHidden = getPredicateValue(hidden, handlerParams);\n\n  useEffect(() => {\n    if (nodeRef.current) {\n      const { innerWidth, innerHeight } = window;\n      const rect = nodeRef.current.getBoundingClientRect();\n      const style: SubMenuState = {};\n\n      if (rect.right < innerWidth) {\n        style.left = '100%';\n        style.right = undefined;\n      } else {\n        style.right = '100%';\n        style.left = undefined;\n      }\n\n      if (rect.bottom > innerHeight) {\n        style.bottom = 0;\n        style.top = 'initial';\n      } else {\n        style.bottom = 'initial';\n      }\n\n      setPosition(style);\n    }\n  }, []);\n\n  function handleClick(e: React.SyntheticEvent) {\n    e.stopPropagation();\n  }\n\n  function trackRef(node: HTMLElement | null) {\n    if (node && !isDisabled)\n      menuRefTracker.set(node, {\n        node,\n        isSubmenu: true,\n        submenuRefTracker: refTracker,\n      });\n  }\n\n  if (isHidden) return null;\n\n  const cssClasses = cx(STYLE.item, className, {\n    [`${STYLE.itemDisabled}`]: isDisabled,\n  });\n\n  const submenuStyle = {\n    ...style,\n    ...position,\n  };\n\n  return (\n    <RefTrackerProvider refTracker={refTracker}>\n      <div\n        {...rest}\n        className={cssClasses}\n        ref={trackRef}\n        tabIndex={-1}\n        role=\"menuitem\"\n        aria-haspopup\n        aria-disabled={isDisabled}\n      >\n        <div className={STYLE.itemContent} onClick={handleClick}>\n          {label}\n          <span className={STYLE.submenuArrow}>{arrow}</span>\n        </div>\n        <div className={STYLE.submenu} ref={nodeRef} style={submenuStyle}>\n          {cloneItems(children, {\n            propsFromTrigger,\n            // injected by the parent\n            triggerEvent: triggerEvent!,\n          })}\n        </div>\n      </div>\n    </RefTrackerProvider>\n  );\n};\n","import {\n  Children,\n  cloneElement,\n  ReactNode,\n  ReactElement,\n  isValidElement,\n} from 'react';\nimport { Item } from './Item';\nimport { Submenu } from './Submenu';\n\nimport {\n  BooleanPredicate,\n  PredicateParams,\n  MenuAnimation,\n  TriggerEvent,\n} from '../types';\n\nexport function isFn(v: any): v is Function {\n  return typeof v === 'function';\n}\n\nexport function isStr(v: any): v is String {\n  return typeof v === 'string';\n}\n\nexport function isTouchEvent(e: TriggerEvent): e is TouchEvent {\n  return e.type === 'touchend';\n}\n\nexport function cloneItems(\n  children: ReactNode,\n  props: { triggerEvent: TriggerEvent; propsFromTrigger?: object }\n): ReactNode[] {\n  return Children.map(\n    // remove null item\n    Children.toArray(children).filter(child => Boolean(child)),\n    child => {\n      if (!isValidElement(child)) {\n        return child;\n      }\n      if (\n        child.type !== Item &&\n        child.type !== Submenu &&\n        child.props.children\n      ) {\n        return cloneItems(child.props.children, props);\n      }\n      return cloneElement(child as ReactElement<any>, props);\n    }\n  );\n}\n\nexport function getMousePosition(e: TriggerEvent) {\n  const pos = {\n    x: 0,\n    y: 0,\n  };\n\n  if (isTouchEvent(e) && e.changedTouches && e.changedTouches.length > 0) {\n    pos.x = e.changedTouches[0].clientX;\n    pos.y = e.changedTouches[0].clientY;\n  } else {\n    pos.x = (e as MouseEvent).clientX;\n    pos.y = (e as MouseEvent).clientY;\n  }\n\n  if (!pos.x || pos.x < 0) {\n    pos.x = 0;\n  }\n\n  if (!pos.y || pos.y < 0) {\n    pos.y = 0;\n  }\n\n  return pos;\n}\n\nexport function getPredicateValue(\n  predicate: BooleanPredicate,\n  payload: PredicateParams\n) {\n  return isFn(predicate) ? predicate(payload) : predicate;\n}\n\nexport function hasExitAnimation(animation: MenuAnimation) {\n  return !!(\n    animation &&\n    (isStr(animation) || ('exit' in animation && animation.exit))\n  );\n}\n","/* global: window */\nimport React, {\n  ReactNode,\n  useEffect,\n  useReducer,\n  useRef,\n  useState,\n} from 'react';\nimport cx from 'clsx';\n\nimport { RefTrackerProvider } from './RefTrackerProvider';\n\nimport { eventManager } from '../core/eventManager';\nimport {\n  TriggerEvent,\n  MenuId,\n  ContextMenuParams,\n  MenuAnimation,\n} from '../types';\nimport { usePrevious, useRefTracker } from '../hooks';\nimport { createMenuController } from './menuController';\nimport { NOOP, STYLE, EVENT } from '../constants';\nimport {\n  cloneItems,\n  getMousePosition,\n  hasExitAnimation,\n  isFn,\n  isStr,\n} from './utils';\n\nexport interface MenuProps\n  extends Omit<React.HTMLAttributes<HTMLElement>, 'id'> {\n  /**\n   * Unique id to identify the menu. Use to Trigger the corresponding menu\n   */\n  id: MenuId;\n\n  /**\n   * Any valid node that can be rendered\n   */\n  children: ReactNode;\n\n  /**\n   * Theme is appended to `react-contexify__theme--${given theme}`.\n   *\n   * Built-in theme are `light` and `dark`\n   */\n  theme?: string;\n\n  /**\n   * Animation is appended to\n   * - `.react-contexify__will-enter--${given animation}`\n   * - `.react-contexify__will-leave--${given animation}`\n   *\n   * - To disable all animations you can pass `false`\n   * - To disable only the enter or the exit animation you can provide an object `{enter: false, exit: 'exitAnimation'}`\n   *\n   * - default is set to `scale`\n   *\n   * To use the built-in animation a helper in available\n   * `import { animation } from 'react-contexify`\n   *\n   * animation.fade\n   */\n  animation?: MenuAnimation;\n\n  /**\n   * Invoked after the menu is visible.\n   */\n  onShown?: (propTrigger?: any) => void;\n\n  /**\n   * Invoked after the menu has been hidden.\n   */\n  onHidden?: () => void;\n}\n\ninterface MenuState {\n  x: number;\n  y: number;\n  visible: boolean;\n  triggerEvent: TriggerEvent;\n  propsFromTrigger: any;\n  willLeave: boolean;\n}\n\nfunction reducer(\n  state: MenuState,\n  payload: Partial<MenuState> | ((state: MenuState) => Partial<MenuState>)\n) {\n  return isFn(payload)\n    ? { ...state, ...payload(state) }\n    : { ...state, ...payload };\n}\n\nexport const Menu: React.FC<MenuProps> = ({\n  id,\n  theme,\n  style,\n  className,\n  children,\n  animation = 'scale',\n  onHidden = NOOP,\n  onShown = NOOP,\n  ...rest\n}) => {\n  const [state, setState] = useReducer(reducer, {\n    x: 0,\n    y: 0,\n    visible: false,\n    triggerEvent: {} as TriggerEvent,\n    propsFromTrigger: null,\n    willLeave: false,\n  });\n  const nodeRef = useRef<HTMLDivElement>(null);\n  const didMount = useRef(false);\n  const wasVisible = usePrevious(state.visible);\n  const refTracker = useRefTracker();\n  const [menuController] = useState(() => createMenuController());\n\n  // subscribe event manager\n  useEffect(() => {\n    didMount.current = true;\n    eventManager.on(id, show).on(EVENT.HIDE_ALL, hide);\n\n    return () => {\n      eventManager.off(id, show).off(EVENT.HIDE_ALL, hide);\n    };\n    // hide rely on setState(dispatch), which is guaranted to be the same across render\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id]);\n\n  // handle show/ hide callback\n  useEffect(() => {\n    if (didMount.current && state.visible !== wasVisible) {\n      state.visible ? onShown(state.propsFromTrigger) : onHidden();\n    }\n    // wasWisible is a ref\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.visible, onHidden, onShown]);\n\n  // collect menu items for keyboard navigation\n  useEffect(() => {\n    if (!state.visible) {\n      refTracker.clear();\n    } else {\n      menuController.init(Array.from(refTracker.values()));\n    }\n  }, [state.visible, menuController, refTracker]);\n\n  // compute menu position\n  useEffect(() => {\n    if (state.visible) {\n      const { innerWidth: windowWidth, innerHeight: windowHeight } = window;\n      const {\n        offsetWidth: menuWidth,\n        offsetHeight: menuHeight,\n      } = nodeRef.current!;\n      let { x, y } = state;\n\n      if (x + menuWidth > windowWidth) {\n        x -= x + menuWidth - windowWidth;\n      }\n\n      if (y + menuHeight > windowHeight) {\n        y -= y + menuHeight - windowHeight + 50;\n      }\n\n      setState({\n        x,\n        y,\n      });\n    }\n\n    // state.visible and state{x,y} are updated together\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.visible]);\n\n  // subscribe dom events\n  useEffect(() => {\n    function handleKeyboard(e: KeyboardEvent) {\n      e.preventDefault();\n      switch (e.key) {\n        case 'Enter':\n          if (!menuController.openSubmenu()) {\n            hide();\n          }\n          break;\n        case 'Escape':\n          hide();\n          break;\n        case 'ArrowUp':\n          menuController.moveUp();\n          break;\n        case 'ArrowDown':\n          menuController.moveDown();\n          break;\n        case 'ArrowRight':\n          menuController.openSubmenu();\n          break;\n        case 'ArrowLeft':\n          menuController.closeSubmenu();\n          break;\n      }\n    }\n\n    if (state.visible) {\n      window.addEventListener('resize', hide);\n      window.addEventListener('contextmenu', hide);\n      window.addEventListener('click', hide);\n      window.addEventListener('mousedown', hide);\n      window.addEventListener('scroll', hide);\n      window.addEventListener('keydown', handleKeyboard);\n\n      // This let us debug the menu in the console in dev mode\n      if (process.env.NODE_ENV !== 'development') {\n        window.addEventListener('blur', hide);\n      }\n    }\n\n    return () => {\n      window.removeEventListener('resize', hide);\n      window.removeEventListener('contextmenu', hide);\n      window.removeEventListener('mousedown', hide);\n      window.removeEventListener('click', hide);\n      window.removeEventListener('scroll', hide);\n      window.removeEventListener('keydown', handleKeyboard);\n\n      if (process.env.NODE_ENV !== 'development') {\n        window.removeEventListener('blur', hide);\n      }\n    };\n    // state.visible will let us get the right reference to `hide`\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.visible, menuController]);\n\n  function show({ event, props, position }: ContextMenuParams) {\n    event.stopPropagation();\n    const { x, y } = position || getMousePosition(event);\n\n    // prevent react from batching the state update\n    // if the menu is already visible we have to recompute bounding rect based on position\n    setTimeout(() => {\n      setState({\n        visible: true,\n        willLeave: false,\n        x,\n        y,\n        triggerEvent: event,\n        propsFromTrigger: props,\n      });\n    }, 0);\n  }\n\n  function hide(event?: Event) {\n    // Safari trigger a click event when you ctrl + trackpad\n    // Firefox:  trigger a click event when right click occur\n    const e = event as KeyboardEvent & MouseEvent;\n\n    if (\n      typeof e !== 'undefined' &&\n      (e.button === 2 || e.ctrlKey === true) &&\n      e.type !== 'contextmenu'\n    ) {\n      return;\n    }\n\n    hasExitAnimation(animation)\n      ? setState(state => ({ willLeave: state.visible }))\n      : setState(state => ({ visible: state.visible ? false : state.visible }));\n  }\n\n  function handleAnimationEnd() {\n    if (state.willLeave && state.visible) {\n      setState({ visible: false, willLeave: false });\n    }\n  }\n\n  function computeAnimationClasses() {\n    if (!animation) {\n      return null;\n    }\n\n    if (isStr(animation)) {\n      return cx({\n        [`${STYLE.animationWillEnter}${animation}`]:\n          animation && visible && !willLeave,\n        [`${STYLE.animationWillLeave}${animation} ${STYLE.animationWillLeave}'disabled'`]:\n          animation && visible && willLeave,\n      });\n    } else if ('enter' in animation && 'exit' in animation) {\n      return cx({\n        [`${STYLE.animationWillEnter}${animation.enter}`]:\n          animation.enter && visible && !willLeave,\n        [`${STYLE.animationWillLeave}${animation.exit} ${STYLE.animationWillLeave}'disabled'`]:\n          animation.exit && visible && willLeave,\n      });\n    }\n\n    return null;\n  }\n\n  const { visible, triggerEvent, propsFromTrigger, x, y, willLeave } = state;\n  const cssClasses = cx(\n    STYLE.menu,\n    className,\n    { [`${STYLE.theme}${theme}`]: theme },\n    computeAnimationClasses()\n  );\n\n  const menuStyle = {\n    ...style,\n    left: x,\n    top: y,\n    opacity: 1,\n  };\n\n  return (\n    <RefTrackerProvider refTracker={refTracker}>\n      {visible && (\n        <div\n          {...rest}\n          className={cssClasses}\n          onAnimationEnd={handleAnimationEnd}\n          style={menuStyle}\n          ref={nodeRef}\n          role=\"menu\"\n          id={id + ''}\n        >\n          {cloneItems(children, {\n            propsFromTrigger,\n            triggerEvent,\n          })}\n        </div>\n      )}\n    </RefTrackerProvider>\n  );\n};\n","import React from 'react';\n\nimport { STYLE } from '../constants';\n\nexport function Separator() {\n  return <div className={STYLE.separator} />;\n}\n"],"names":["Context","createContext","useRefTrackerContext","useContext","RefTrackerProvider","props","React","Provider","value","refTracker","children","createEventManager","eventList","Map","on","event","handler","has","get","add","set","Set","off","emit","args","process","env","NODE","currentEv","console","error","forEach","eventManager","usePrevious","ref","useRef","useEffect","current","useRefTracker","contextMenu","show","id","position","preventDefault","nativeEvent","hideAll","useContextMenu","params","createMenuController","menuList","focusedIndex","parentNode","isAtRoot","currentItems","forceCloseSubmenu","init","rootMenu","focusSelectedItem","node","focus","isSubmenuFocused","isSubmenu","getSubmenuItems","Array","from","submenuRefTracker","values","isFocused","moveDown","length","closeSubmenu","moveUp","openSubmenu","submenuItems","currentNode","isRoot","items","classList","parentFocusedIndex","menuParentNode","remove","clear","theme","light","dark","animation","fade","flip","scale","slide","NOOP","Item","className","style","triggerEvent","data","propsFromTrigger","onClick","disabled","hidden","rest","handlerParams","isDisabled","getPredicateValue","isHidden","handleClick","e","stopPropagation","trackRef","handleKeyDown","key","cssClasses","cx","onKeyDown","tabIndex","role","Submenu","arrow","label","menuRefTracker","nodeRef","useState","left","top","bottom","setPosition","window","innerWidth","innerHeight","rect","getBoundingClientRect","right","undefined","submenuStyle","cloneItems","isFn","v","isStr","isTouchEvent","type","Children","map","toArray","filter","child","Boolean","isValidElement","cloneElement","getMousePosition","pos","x","y","changedTouches","clientX","clientY","predicate","payload","hasExitAnimation","exit","reducer","state","Menu","onHidden","onShown","useReducer","visible","willLeave","setState","didMount","wasVisible","menuController","hide","windowWidth","windowHeight","menuWidth","offsetWidth","menuHeight","offsetHeight","handleKeyboard","addEventListener","removeEventListener","setTimeout","button","ctrlKey","handleAnimationEnd","computeAnimationClasses","enter","menuStyle","opacity","onAnimationEnd","Separator"],"mappings":"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"}